-- Semana 6: Subconsultas 

select * from Clientes;
select * from Empleados;

-- Subconsulta Escalar: Devuelve un solo valor:
SELECT Nombre, Salario
FROM Empleados
WHERE Salario > (SELECT AVG(Salario) FROM Empleados);


-- Subconsulta de Tabla: Devuelve un conjunto de filas.
SELECT Nombre, Apellido
FROM Clientes
WHERE DNI IN (SELECT DISTINCT DNI_cliente FROM Pedidos);

-- Subconsulta Correlacionada: Depende de la consulta principal y se evalúa fila por fila.
SELECT p1.Nombre, p1.Stock, p1.ID_Categoria
FROM Productos p1
WHERE p1.Stock > (
    SELECT AVG(p2.Stock)
    FROM Productos p2
    WHERE p2.ID_Categoria = p1.ID_Categoria
);

-- Consultas con JOIN:

-- Productos que han sido vendidos // Devuelve filas cuando hay coincidencias en ambas tablas.
SELECT p.Nombre, dp.Cantidad, dp.Precio_unitario
FROM Productos p
INNER JOIN Detalles_pedido dp ON p.ID_Producto = dp.ID_Producto;


-- Todos los productos, incluso los no vendidos // : Devuelve todas las filas de la tabla izquierda y las filas coincidentes de la derecha. Las filas sin
-- coincidencias muestran NULL.
SELECT p.Nombre, dp.Cantidad
FROM Productos p
LEFT JOIN Detalles_pedido dp ON p.ID_Producto = dp.ID_Producto;


-- Todos los detalles de pedido, incluso si el producto fue eliminado // Similar al LEFT JOIN, pero devuelve todas las filas de la tabla derecha.
SELECT dp.ID_Detalle, p.Nombre
FROM Productos p
RIGHT JOIN Detalles_pedido dp ON p.ID_Producto = dp.ID_Producto;


-- Todos los empleados y movimientos (coincidencias y no coincidencias) // Devuelve filas cuando hay coincidencias en una de las tablas. Las filas sin coincidencias muestran NULL
-- en el lado correspondiente.
SELECT e.Nombre, i.Tipo_movimiento
FROM Empleados e
FULL JOIN inventario i ON e.DNI = i.DNI_Empleado;


-- Combinar 3 categorías con 3 productos // Devuelve el producto cartesiano de las dos tablas.
SELECT TOP 3 c.Nombre as Categoria, p.Nombre as Producto
FROM Categorias c
CROSS JOIN Productos p
ORDER BY c.Nombre, p.Nombre;

-- UNION:

-- Empleados de Ventas y Tecnología (sin duplicados)
SELECT Nombre, Apellido FROM Empleados WHERE Departamento = 'Ventas'
UNION
SELECT Nombre, Apellido FROM Empleados WHERE Departamento = 'Tecnologia';

-- Todos los empleados de Lima y Arequipa (con posibles duplicados)
SELECT Nombre, Apellido, Departamento FROM Empleados WHERE Departamento = 'Ventas'
UNION ALL
SELECT Nombre, Apellido, Departamento FROM Empleados WHERE Departamento = 'Tecnologia';

